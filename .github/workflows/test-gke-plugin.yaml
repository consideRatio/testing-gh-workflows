name: Test GKE Plugin setup

on:
  pull_request:

jobs:
  test-gke-plugin-setup:
    runs-on: ubuntu-22.04
    steps:
      - run: |
          set -x
          echo 1
          REPO_URL="https://packages.cloud.google.com/apt"
          echo 2
          echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] $REPO_URL cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list >/dev/null
          echo 3
          sudo wget -q https://packages.cloud.google.com/apt/doc/apt-key.gpg -O /usr/share/keyrings/cloud.google.gpg

          echo 4
          sudo apt-get update -y
          echo 5
          sudo apt-get install -y google-cloud-sdk-gke-gcloud-auth-plugin
